<!DOCTYPE html>
<html>
  <head>
    <title>Contrack ç®¡ç†ç”»é¢</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_pack_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>
  </head>

  <body>
    <!-- ç®¡ç†è€…ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="bg-light border-bottom">
      <div class="container d-flex justify-content-between align-items-center py-2" style="max-width: 1000px;">
        <h1 class="h5 mb-0">
          <% if admin_signed_in? %>
            <%= link_to "Contrackç®¡ç†ç”»é¢", admin_contracts_path, class: "text-dark text-decoration-none fw-bold" %>
          <% else %>
            <span class="text-dark fw-bold">Contrackç®¡ç†ç”»é¢</span>
          <% end %>
        </h1>

        <% if admin_signed_in? %>
          <nav>
            <ul class="nav">
              <li class="nav-item me-2 small text-muted d-flex align-items-center">
                ã‚ˆã†ã“ã <strong class="ms-1">ç®¡ç†è€…</strong> ã•ã‚“
              </li>
              <li class="nav-item"><%= link_to "å¥‘ç´„ä¸€è¦§", admin_contracts_path, class: "nav-link px-2" %></li>
              <li class="nav-item"><%= link_to "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¸€è¦§", admin_statuses_path, class: "nav-link px-2" %></li>
              <li class="nav-item"><%= link_to "ä¼šå“¡ä¸€è¦§", admin_users_path, class: "nav-link px-2" %></li>
              <li class="nav-item"><%= link_to "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ", destroy_admin_session_path, method: :delete, class: "nav-link text-danger px-2" %></li>
            </ul>
          </nav>
        <% end %>
      </div>
    </header>

    <!-- ğŸ” æ¤œç´¢ãƒãƒ¼ï¼šãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ã¿è¡¨ç¤º -->
    <% if admin_signed_in? %>
      <div class="bg-light border-bottom">
        <div class="container py-2 d-flex justify-content-end" style="max-width: 1000px;">
          <%= form_with url: admin_search_path, method: :get, local: true, class: "d-flex flex-wrap align-items-end gap-2 justify-content-end" do %>
            <!-- æ¤œç´¢å¯¾è±¡é¸æŠ -->
            <div>
              <%= label_tag :search_type, "æ¤œç´¢å¯¾è±¡", class: "form-label me-1" %>
              <%= select_tag :search_type,
                  options_for_select([
                    ["ãƒ¦ãƒ¼ã‚¶ãƒ¼", "users"],
                    ["å¥‘ç´„æ›¸", "contracts"]
                  ], params[:search_type] || "users"),
                  class: "form-select form-select-sm d-inline w-auto" %>
            </div>

            <!-- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ -->
            <%= text_field_tag :keyword, params[:keyword], placeholder: "ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›", class: "form-control form-control-sm w-auto" %>

            <!-- å¥‘ç´„æ›¸æ¤œç´¢æ™‚ã®è¿½åŠ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
            <div id="contract-filters" style="display: none;">
              <div>
                <%= label_tag :status_id, "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", class: "form-label me-1" %>
                <%= select_tag :status_id,
                    options_from_collection_for_select(Status.all, :id, :name, params[:status_id]),
                    include_blank: "ã™ã¹ã¦", class: "form-select form-select-sm d-inline w-auto" %>
              </div>

              <div>
                <%= label_tag :tag, "ã‚¿ã‚°", class: "form-label me-1" %>
                <%= select_tag :tag,
                    options_for_select(ActsAsTaggableOn::Tag.pluck(:name), params[:tag]),
                    include_blank: "ã™ã¹ã¦", class: "form-select form-select-sm d-inline w-auto" %>
              </div>
            </div>

            <%= submit_tag "æ¤œç´¢", class: "btn btn-sm btn-outline-primary" %>
          <% end %>
        </div>
      </div>
    <% end %>

    <script>
      // æ¤œç´¢å¯¾è±¡ãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚ã®å‡¦ç†
      document.addEventListener('DOMContentLoaded', function() {
        const searchTypeSelect = document.getElementById('search_type');
        const contractFilters = document.getElementById('contract-filters');
        
        function toggleFilters() {
          if (searchTypeSelect.value === 'contracts') {
            contractFilters.style.display = 'flex';
          } else {
            contractFilters.style.display = 'none';
          }
        }
        
        searchTypeSelect.addEventListener('change', toggleFilters);
        toggleFilters(); // åˆæœŸè¡¨ç¤º
      });
    </script>

    <!-- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div class="container mt-3" style="max-width: 1000px;">
      <% flash.each do |key, value| %>
        <div class="alert alert-<%= key == 'notice' ? 'success' : 'danger' %>" role="alert">
          <%= value %>
        </div>
      <% end %>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ -->
    <main class="container mt-4" style="max-width: 1000px;">
      <%= yield %>
    </main>
  </body>
</html>
