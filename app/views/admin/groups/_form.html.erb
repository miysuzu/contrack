<div class="card shadow mb-4" style="border-radius: 16px;">
  <div class="card-body">
    <h5 class="card-title text-primary fw-bold mb-3">
      <i class="fas fa-users me-2"></i>グループ情報
    </h5>
    <%= form_with(model: group, url: group.new_record? ? admin_groups_path : admin_group_path(group), local: true) do |form| %>
      <% if group.errors.any? %>
        <div class="alert alert-danger rounded-3">
          <h5 class="fw-bold"><%= pluralize(group.errors.count, "件のエラー") %>があります:</h5>
          <ul class="mb-0">
            <% group.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
      
      <div class="form-group mb-3">
        <%= form.label :name, 'グループ名', class: 'form-label fw-bold' %>
        <%= form.text_field :name, class: 'form-control rounded-3 shadow-sm', placeholder: 'グループ名を入力してください', required: true, maxlength: 50 %>
        <div class="form-text text-muted">1文字以上50文字以下で入力してください</div>
      </div>
      
      <div class="form-group mb-3">
        <%= form.label :description, '説明文', class: 'form-label fw-bold' %>
        <%= form.text_area :description, class: 'form-control rounded-3 shadow-sm', rows: 4, placeholder: 'グループの説明を入力してください' %>
      </div>

      <%# ユーザー招待セクション（新規作成時のみ表示） %>
      <% if group.new_record? && @company_users.present? %>
        <div class="form-group mb-3">
          <label class="form-label fw-bold">
            <i class="fas fa-user-plus me-2"></i>メンバーを招待
          </label>
          <div class="card bg-light border-0">
            <div class="card-body p-3">
              <p class="text-muted small mb-3">
                同じ会社のユーザーをグループに招待できます（複数選択可能）
              </p>
              <div class="row">
                <% @company_users.each do |user| %>
                  <div class="col-md-6 mb-2">
                    <div class="form-check">
                      <%= check_box_tag 'group[invited_user_ids][]', user.id, false, 
                          class: 'form-check-input', 
                          id: "user_#{user.id}" %>
                      <label class="form-check-label" for="user_<%= user.id %>">
                        <strong><%= user.name %></strong>
                        <br>
                        <small class="text-muted"><%= user.email %></small>
                      </label>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>

      <%# メンバー管理セクション（編集時のみ表示） %>
      <% unless group.new_record? %>
        <div class="form-group mb-3">
          <label class="form-label fw-bold">
            <i class="fas fa-users me-2"></i>メンバー管理
          </label>
          
          <%# 現在のメンバー一覧 %>
          <div class="card mb-3 border-0">
            <div class="card-header bg-light border-0">
              <h6 class="mb-0 text-primary fw-bold">
                <i class="fas fa-user-check me-2"></i>現在のメンバー
              </h6>
            </div>
            <div class="card-body p-3">
              <% if group.users.any? %>
                <div class="row">
                  <% group.users.each do |user| %>
                    <div class="col-md-6 mb-2">
                      <div class="form-check">
                        <%= check_box_tag 'group[remove_user_ids][]', user.id, false, 
                            class: 'form-check-input', 
                            id: "remove_user_#{user.id}" %>
                        <label class="form-check-label" for="remove_user_<%= user.id %>">
                          <strong><%= user.name %></strong>
                          <br>
                          <small class="text-muted"><%= user.email %></small>
                        </label>
                      </div>
                    </div>
                  <% end %>
                </div>
                <small class="text-muted">
                  <i class="fas fa-info-circle me-1"></i>
                  チェックしたメンバーをグループから削除します
                </small>
              <% else %>
                <p class="text-muted mb-0">メンバーがいません。</p>
              <% end %>
            </div>
          </div>

          <%# 追加可能なユーザー一覧 %>
          <% if @company_users.present? %>
            <div class="card border-0">
              <div class="card-header bg-light border-0">
                <h6 class="mb-0 text-success fw-bold">
                  <i class="fas fa-user-plus me-2"></i>追加可能なメンバー
                </h6>
              </div>
              <div class="card-body p-3">
                <div class="row">
                  <% @company_users.each do |user| %>
                    <div class="col-md-6 mb-2">
                      <div class="form-check">
                        <%= check_box_tag 'group[add_user_ids][]', user.id, false, 
                            class: 'form-check-input', 
                            id: "add_user_#{user.id}" %>
                        <label class="form-check-label" for="add_user_<%= user.id %>">
                          <strong><%= user.name %></strong>
                          <br>
                          <small class="text-muted"><%= user.email %></small>
                        </label>
                      </div>
                    </div>
                  <% end %>
                </div>
                <small class="text-muted">
                  <i class="fas fa-info-circle me-1"></i>
                  チェックしたユーザーをグループに追加します
                </small>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
      
      <div class="d-grid gap-2 d-md-flex justify-content-md-center mt-4">
        <%= form.submit group.new_record? ? '作成' : '更新', class: 'btn btn-primary px-4' %>
        <%= link_to admin_groups_path, class: 'btn btn-secondary px-4' do %>
          <i class="fas fa-arrow-left me-2"></i>一覧へ戻る
        <% end %>
      </div>
    <% end %>
  </div>
</div> 